<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.group60.dao.UserDao">

    <select id="findByEmail" parameterType="String" resultType="User">
        select email_address, password, user_id from `users`
        where email_address = #{email_address}
    </select>
    <insert id="saveUser" parameterType="User" useGeneratedKeys="true" keyProperty="user_id">
        insert into `users` (user_id, email_address, password)
        values (#{user_id}, #{email_address}, #{password})
    </insert>
    <select id="lists" resultType="Party">
        select party_id, title, description, max_member, current_member, place, start_time, belongs_to
        from `parties`
    </select>
    <insert id="saveParty" useGeneratedKeys="true" keyProperty="party.party_id">
        insert into `parties` (party_id, title, description, max_member, current_member, place, belongs_to)
        values (#{party.party_id}, #{party.title}, #{party.description}, #{party.max_member}, '1', #{party.place}, #{user_id})
    </insert>
    <select id="myParty" parameterType="int" resultType="Party">
        select p.party_id, title, description, max_member, current_member, place, start_time, belongs_to
        from `parties` as p, `users_parties` as up, `users` as u
        where u.user_id = #{user_id} and u.user_id = up.user_id and p.party_id = up.party_id
        order by p.party_id
    </select>
    <select id="findPair" resultType="Pair">
        select *
        from `users_parties`
        where party_id = #{party_id} and user_id = #{user_id}
    </select>
    <insert id="joinParty">
        insert into `users_parties` (party_id, user_id)
        values (#{party_id}, #{user_id})
    </insert>
    <select id="checkParty" parameterType="int" resultType="CheckMember">
        select max_member, current_member
        from `parties`
        where party_id = #{party_id}
    </select>
    <update id="addMember" parameterType="int">
        update `parties`
        set current_member = current_member + '1'
        where party_id = #{party_id}
    </update>
    <update id="deleteMember" parameterType="int">
        update `parties`
        set current_member = current_member - '1'
        where party_id = #{party_id}
    </update>
    <delete id="quitParty">
        delete from `users_parties`
        where user_id = #{user_id} and party_id = #{party_id};
    </delete>
</mapper>